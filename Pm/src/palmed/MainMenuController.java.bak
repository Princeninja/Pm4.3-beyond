/**
 * Copyright 2010 the original author or authors.
 * 
 * This file is part of Zksample2. http://zksample2.sourceforge.net/
 *
 * Zksample2 is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * Zksample2 is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Zksample2.  If not, see <http://www.gnu.org/licenses/gpl.html>.
 */
package palmed;

import java.io.Serializable;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;


import org.zkoss.util.*;
import org.zkoss.util.resource.Labels;
import org.zkoss.zk.ui.*;
import org.zkoss.zk.ui.event.Event;
import org.zkoss.zk.ui.event.EventListener;
import org.zkoss.zk.ui.util.GenericForwardComposer;

import org.zkoss.zul.*;

import usrlib.Date;
import usrlib.DialogHelpers;
import usrlib.Rec;



/**
 * 
 * Main menu controller. <br>
 * <br>
 * Added the buttons for expanding/closing the menu tree. Calls the menu
 * factory.
 * 
 * @author bbruhns
 * @author sgerth
 * 
 * 
 */
public class MainMenuController extends GenericForwardComposer  {

	private static final long serialVersionUID = -909795057747345551L;
//	private static final Logger logger = Logger.getLogger(MainMenuController.class);

	/*
	 * ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	 * All the components that are defined here and have a corresponding
	 * component with the same 'id' in the zul-file are getting autowired by our
	 * 'extends BaseCtrl' class wich extends Window and implements AfterCompose.
	 * ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	 */
	private Window mainMenuWindow; // autowire
	private Tree mainMenuTree;	// autowire
	
	

	private static String bgColor = "D6DCDE";
	private static String bgColorInner = "white";

	public void onCreate$mainMenuWindow(Event event) throws Exception {

		// doOnCreateCommon(mainMenuWindow, event); // wire vars
//		doOnCreateCommon(getMainMenuWindow(), event); // wire vars
		System.out.println( "MainMenuController.onCreate$mainMenuWindow()" );

		createMenu();
	}

	/**
	 * Creates the mainMenu. <br>
	 * 
	 * @throws InterruptedException
	 */
	private void createMenu() throws InterruptedException {

		Toolbarbutton toolbarbutton;
		
		System.out.println( "MainMenuController.createMenu()" );


		final Groupbox gb = (Groupbox) getMainMenuWindow().getFellowIfAny("groupbox_menu");
		// gb.setHeight("500px");

		// Hbox for the expand/collapse buttons
		final Hbox hbox = new Hbox();
		hbox.setStyle("backgound-color: " + bgColorInner);
		hbox.setParent(gb);

		// ToolbarButton for expanding the menutree
		toolbarbutton = new Toolbarbutton();
		hbox.appendChild(toolbarbutton);
		toolbarbutton.setId("btnMainMenuExpandAll");
		toolbarbutton.setImage("expand_icon.gif");
		toolbarbutton.setTooltiptext( "Expand All" /*Labels.getLabel("btnFolderExpand.tooltiptext")*/ );
		toolbarbutton.addEventListener("onClick", new EventListener() {
//			@Override
			public void onEvent(Event event) throws Exception {
				onClick$btnMainMenuExpandAll(event);
			}
		});
		toolbarbutton = new Toolbarbutton();
		hbox.appendChild(toolbarbutton);
		toolbarbutton.setId("btnMainMenuCollapseAll");
		toolbarbutton.setImage("collapse_icon.gif");
		toolbarbutton.setTooltiptext( "Collapse All" /*Labels.getLabel( "btnFolderCollapse.tooltiptext")*/ );
		toolbarbutton.addEventListener("onClick", new EventListener() {
//			@Override
			public void onEvent(Event event) throws Exception {
				onClick$btnMainMenuCollapseAll(event);
			}
		});

		// toolbarbutton = new Toolbarbutton();
		// hbox.appendChild(toolbarbutton);
		// toolbarbutton.setId("btnMainMenuChange");
		//
		// toolbarbutton.setImage("/images/icons/menu_16x16.gif");
		// // toolbarbutton.setImage("/images/icons/combobox_16x16.gif");
		// toolbarbutton.setTooltiptext(Labels.getLabel("btnMainMenuChange.tooltiptext"));
		// toolbarbutton.addEventListener("onClick", new EventListener() {
		// @Override
		// public void onEvent(Event event) throws Exception {
		// onClick$btnMainMenuChange(event);
		// }
		// });

		// toolbarbutton = new Toolbarbutton();
		// hbox.appendChild(toolbarbutton);
		// toolbarbutton.setId("btnMainMenuDocumentation");
		//		
		// toolbarbutton.setImage("/images/icons/icon-pdf_16x16.png");
		// toolbarbutton.setTooltiptext(Labels.getLabel("btnMainMenuDocumentation.tooltiptext"));
		// toolbarbutton.addEventListener("onClick", new EventListener() {
		// @Override
		// public void onEvent(Event event) throws Exception {
		// //
		// Executions.getCurrent().sendRedirect("the_url_generated_of_report","_blank");
		// //
		// Executions.getCurrent().sendRedirect("http://sunet.dl.sourceforge.net/project/zksample2/Documentation/zksample2-doc.pdf",
		// // "_blank");
		//		
		// final String url1 =
		// "http://sunet.dl.sourceforge.net/project/zksample2/Documentation/zksample2-doc.pdf";
		// Clients.evalJavaScript("window.open('" + url1
		// +
		// "','','top=100,left=200,height=600,width=800,scrollbars=1,resizable=1')");
		// }
		// });

		Separator separator = createSeparator(false);
		separator.setWidth("97%");
		separator.setStyle("background-color: " + bgColorInner);
		separator.setBar(false);
		separator.setParent(gb);

		separator = createSeparator(false);
		separator.setWidth("97%");
		separator.setBar(true);
		separator.setParent(gb);

		// ++++++++++++++++++++++++++++++++++++++++++++++++++++++//

		// the menuTree
		final Tree tree = new Tree();
		// tree.setSizedByContent(true);
		tree.setStyle("overflow:auto;");
		tree.setParent(gb);

		// tree.setZclass("z-dottree");
		tree.setStyle("border: none");

		final Treechildren treechildren = new Treechildren();
		tree.appendChild(treechildren);

		// generate the treeMenu from the menuXMLFile
//		ZkossTreeMenuFactory.addMainMenu(treechildren);

		final Separator sep1 = new Separator();
		sep1.setWidth("97%");
		sep1.setBar(false);
		sep1.setParent(gb);

		/* as standard, call the welcome page */
//		showPage("/WEB-INF/pages/welcome.zul", "Start");

	}

	
	
	public void onSelect$mainMenuTree( Event event ) throws Exception{

		Treeitem i = mainMenuTree.getSelectedItem();
		String itemID = mainMenuTree.getSelectedItem().getId();
		
		if ( itemID.equals( "ptchart" )){
			
			createPtChart();
			
		} else if ( itemID.equals( "soapsht" )){
				
				createSoapSheetWin();
				
		} else if ( itemID.equals( "ptledger")){

			createLedger();

		} else if ( itemID.equals( "rxstatus")){

			createRxStatus();

		} else if ( itemID.equals( "editpt")){

			createEditPt();

		} else if ( itemID.equals( "newpt")){

			createNewPt();
			
		} else if ( itemID.equals( "editprov")){
			
			createEditProv();
			
		} else if ( itemID.equals( "newprov" )){
			
			createNewProv();

		} else if ( itemID.equals( "srvcode" )){
			
			alert( "srvcde" );

		} else if ( itemID.equals( "ProbTbl" )){
			
			createProbTblWin();
			
			
		} else if ( itemID.equals( "foxnews" )){
			
			createBrowser( "http://www.foxnews.com" );
			
		} else if ( itemID.equals( "erxconfig" )){
			
			createERxConfig();
			
		} else if ( itemID.equals( "erxprov" )){
			
			createERxProvWin();
			
		} else if ( itemID.equals( "userwin" )){
			
			createUserWin();
			
		} else if ( itemID.equals( "useredit" )){
			
			createUserEditWin();
			
		} else if ( itemID.equals( "ecs" )){
			
			createEcsWin();
			
		} else if ( itemID.equals( "pmimport" )){
			
			createPmImportWin();
			
		} else if ( itemID.equals( "audit" )){
			
			createAuditWin();
			
		} else if ( itemID.equals( "vaccvx" )){
			
			createVaccineCVXWin();
			
		} else if ( itemID.equals( "vacmvx" )){
			
			createVaccineMVXWin();
			
		} else if ( itemID.equals( "labobstbl" )){
			
			createLabObsTblWin();
			
		} else if ( itemID.equals( "labbat" )){
			
			createLabBatWin();
			
		} else if ( itemID.equals( "labfac" )){
			
			createLabFacilityWin();
			
		} else if ( itemID.equals( "labimport" )){
			
			createLabImport();
			
		} else if ( itemID.equals( "cdsRules" )){
			
			createCDSRulesWin();
			
		} else if ( itemID.equals( "reminders" )){
			
			createRemindersWin();
			
		} else if ( itemID.equals( "listpt" )){
			
			createPtListWin();
			
		} else if ( itemID.equals( "cqm" )){
			
			createCQMWin();
			
		} else if ( itemID.equals( "amc" )){
			
			createAMCWin();
			
		} else if ( itemID.equals( "xfrVitals" )){
			
			createXfrVitals();
			
		} else if ( itemID.equals( "xfrPARs" )){
			
			createXfrPARs();
			
		} else if ( itemID.equals( "scheduler" )){
			
			createSchWin();
			
		} else if ( itemID.equals( "cdmDashboard" )){
			
			createCdmDashboard();
			
		} else if ( itemID.equals( "about" )){
			
			createAboutWin();
			
		} else {
			
			// if empty, assume category - toggle open state
			if ( ! i.isEmpty()){
				i.setOpen( i.isOpen() ? false: true );
			} else {
			
				alert( "Not yet supported: " + itemID );
			}
		}

		
		// clear the selection so we can choose again
		mainMenuTree.clearSelection();
		
		return;
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	/**
	 * Creates a seperator. <br>
	 * 
	 * @param withBar
	 * <br>
	 *            true=with Bar <br>
	 *            false = without Bar <br>
	 * @return
	 */
	private static Separator createSeparator(boolean withBar) {

		final Separator sep = new Separator();
		sep.setStyle("backgound-color: " + bgColorInner);
		sep.setBar(withBar);

		return sep;
	}

	public final class GuestBookListener implements EventListener {
//		@Override
		public void onEvent(Event event) throws Exception {

			showPage("/WEB-INF/pages/guestbook/guestBookList.zul", "Guestbook");
		}
	}

	/**
	 * Creates a page from a zul-file in a tab in the center area of the
	 * borderlayout. Checks if the tab is opened before. If yes than it selects
	 * this tab.
	 * 
	 * @param zulFilePathName
	 *            The ZulFile Name with path.
	 * @param tabName
	 *            The tab name.
	 * @throws InterruptedException
	 */
	private void showPage(String zulFilePathName, String tabName) throws InterruptedException {
		System.out.println( "MainMenuController.showPage()" );

		try {
			// TODO get the parameter for working with tabs from the application
			// params
			final int workWithTabs = 1;

			if (workWithTabs == 1) {



				// Check if the tab is already open.

				Tab checkTab = tabExists( tabName.trim());
				

				if (checkTab == null) {
					System.out.println( "MainMenuController.showPage() creating new tab" );

					// Create new tab, set Id, set title, make closeable, and set parent
					final Tab tab = createTab( tabName.trim(), tabName.trim());
					

					// Create new tabpanel, set size, style, and parent
					final Tabpanel tabpanel = createTabpanel();
					
					
					/*
					 * create the page and put it in the tabs area
					 */
					Executions.createComponents(zulFilePathName, tabpanel, null);
					tab.setSelected(true);

				}
			} else {
				/* get an instance of the borderlayout defined in the zul-file */
				final Borderlayout bl = (Borderlayout) Path.getComponent("/outerIndexWindow/borderlayoutMain");
				/* get an instance of the searched CENTER layout area */
				final Center center = bl.getCenter();
				/* clear the center child comps */
				center.getChildren().clear();
				/*
				 * create the page and put it in the center layout area
				 */

				Executions.createComponents(zulFilePathName, center, null);
			}

//			if (logger.isDebugEnabled()) {
//				logger.debug("--> calling zul-file: " + zulFilePathName);
//			}
		} catch (final Exception e) {
			Messagebox.show(e.toString());
		}
		System.out.println( "returning" );
	}

	
	/*
	 * Get Tabbox
	 */
	public Tabbox getTabbox(){
		final Borderlayout bl = (Borderlayout) Path.getComponent("/pmMainWin/borderlayoutMain");
		final Center center = bl.getCenter();
		Tabbox tabs = (Tabbox) center.getFellow("divCenter").getFellow("tabBoxIndexCenter");
		return tabs;
	}
	
	/*
	 * Get tabs
	 */
	public Tabs getTabs(){
		final Borderlayout bl = (Borderlayout) Path.getComponent("/pmMainWin/borderlayoutMain");
		final Center center = bl.getCenter();
		Tabs tabs = (Tabs) center.getFellow("divCenter").getFellow("tabBoxIndexCenter").getFellow("tabsIndexCenter");
		return tabs;
	}
	
	/*
	 * Does Tab 'tabname' already exist?
	 */
	public Tab tabExists( String tabName ){

		Tab checkTab = null;
		try {
			checkTab = (Tab) getTabs().getFellow( "tab_" + tabName.trim());

		} catch (final ComponentNotFoundException ex) { /* Ignore  */ }

		return checkTab;
	}
	
	/*
	 * Make new tab
	 * Create new tab, set Id, set title, make closeable, and set parent
	 */
	public Tab createTab( String id, String title ){
		final Tab tab = new Tab();
		tab.setId( "tab_" + id);
		tab.setLabel(title);
		tab.setClosable(true);
		tab.setParent( getTabs());
		return tab;		
	}
	
	/*
	 * Create new tabpanel, set size, style, and parent
	*/
	public Tabpanel createTabpanel( ){
		
		final Tabpanels tabpanels = (Tabpanels) getTabs().getFellow("tabpanelsBoxIndexCenter");
		final Tabpanel tabpanel = new Tabpanel();
		tabpanel.setHeight("100%");
		tabpanel.setStyle("padding: 0px;");
		tabpanel.setParent(tabpanels);
		return tabpanel;
	}

	
	
	
	
	
	public Window getMainMenuWindow() {
		return this.mainMenuWindow;
	}

	public void setMainMenuWindow(Window mainMenuWindow) {
		this.mainMenuWindow = mainMenuWindow;
	}

	public void onClick$btnMainMenuExpandAll(Event event) throws Exception {

		doCollapseExpandAll(getMainMenuWindow(), true);
	}

	public void onClick$btnMainMenuCollapseAll(Event event) throws Exception {

		doCollapseExpandAll(getMainMenuWindow(), false);
	}

	public void onClick$btnMainMenuChange(Event event) throws Exception {

		// correct the desktop height
		final Checkbox cb = (Checkbox) Path.getComponent("/outerIndexWindow/CBtreeMenu");
		cb.setChecked(false);

		// UserWorkspace.getInstance().setTreeMenu(false);

		// get an instance of the borderlayout defined in the index.zul-file
		final Borderlayout bl = (Borderlayout) Path.getComponent("/outerIndexWindow/borderlayoutMain");
		// get an instance of the searched west layout area
		final West west = bl.getWest();
		west.setVisible(false);

		final North north = bl.getNorth();
		north.setFlex(true); // that's important !!!!

		final Div div = (Div) north.getFellow("divDropDownMenu");

		final Menubar menuBar = (Menubar) div.getFellow("mainMenuBar");
		menuBar.setVisible(true);

		// generate the menu from the menuXMLFile
//		ZkossDropDownMenuFactory.addDropDownMenu(menuBar);

		final Menuitem changeToTreeMenu = new Menuitem();
		changeToTreeMenu.setLabel(Labels.getLabel("menu_Item_backToTree"));
		changeToTreeMenu.setImage("/images/icons/refresh2_yellow_16x16.gif");
		changeToTreeMenu.setParent(menuBar);
		changeToTreeMenu.addEventListener("onClick", new EventListener() {
//			@Override
			public void onEvent(Event event) throws Exception {
				// get an instance of the borderlayout defined in the
				// index.zul-file
				final Borderlayout bl = (Borderlayout) Path.getComponent("/outerIndexWindow/borderlayoutMain");
				// get an instance of the searched west layout area
				final West west = bl.getWest();
				west.setVisible(true);

				final North north = bl.getNorth();

				final Div div = (Div) north.getFellow("divDropDownMenu");

				final Menubar menuBar = (Menubar) div.getFellow("mainMenuBar");
				menuBar.getChildren().clear();
				menuBar.setVisible(false);
				north.setFlex(false); // that's important !!!!

				// correct the desktop height
				final Checkbox cb = (Checkbox) Path.getComponent("/outerIndexWindow/CBtreeMenu");
				cb.setChecked(true);

				// UserWorkspace.getInstance().setTreeMenu(true);

				// Refresh the whole page for setting correct sizes of the
				// components
				final Window win = (Window) Path.getComponent("/outerIndexWindow");
				win.invalidate();

			}
		});

		// Guestbook
		final Menuitem guestBookMenu = new Menuitem();
		guestBookMenu.setLabel("ZK Guestbook");
		guestBookMenu.addEventListener("onClick", new GuestBookListener());
		guestBookMenu.setParent(menuBar);

		// Refresh the whole page for setting correct sizes of the
		// components
		final Window win = (Window) Path.getComponent("/outerIndexWindow");
		win.invalidate();
	}

	private void doCollapseExpandAll(Component component, boolean aufklappen) {
		if (component instanceof Treeitem) {
			final Treeitem treeitem = (Treeitem) component;
			treeitem.setOpen(aufklappen);
		}
		final Collection<?> com = component.getChildren();
		if (com != null) {
			for (final Iterator<?> iterator = com.iterator(); iterator.hasNext();) {
				doCollapseExpandAll((Component) iterator.next(), aufklappen);

			}
		}
	}
	
	
	
	
	/**
	 * Create PtChart
	 */
	
	
	public void createPtChart(){
		showPtChart( null );
	}
	
	public void createPtChart( Rec ptRec ){
		showPtChart( ptRec );
	}
	
	public void showPtChart( Rec ptRec ){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		
		
		// Does user have permission?
		if ( ! Perms.isRequestPermitted( Perms.Medical.VIEW )){
			SystemHelpers.msgAccessDenied();
			return;
		}


		
		// If no particular patient specified, search for a patient
		if ( ! Rec.isValid( ptRec )){
			ptRec = new Rec( PtSearch.show());
			if ( ptRec.getRec() < 2 ){
				// No patient found
				return;
			}			
		}
		
		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "ptchart_" + ptRec.getRec();		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "PtChart" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		PtChart.show( ptRec, tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	
	
	
	
	
	/**
	 * Create SoapSheetWin
	 */
	
	
	public void createSoapSheetWin(){
		showSoapSheetWin( null );
	}
	
	public void createSoapSheetWin( Rec ptRec ){
		showSoapSheetWin( ptRec );
	}
	
	public void showSoapSheetWin( Rec ptRec ){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		
		
		// Does user have permission?
		if ( ! Perms.isRequestPermitted( Perms.Medical.VIEW )){
			SystemHelpers.msgAccessDenied();
			return;
		}


		// If no particular patient specified, search for a patient
		if ( ! Rec.isValid( ptRec )){
			ptRec = new Rec( PtSearch.show());
			if ( ! Rec.isValid( ptRec )){
				// No patient found
				return;
			}			
		}
		
		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "soapsht_" + ptRec.getRec();		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "SoapSheet" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create SoapSheet
		SoapSheetWin.show( ptRec, tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	
	
	
	
	
	/**
	 * Create Ledger
	 */

	public void createLedger(){
		showLedger( null );
	}
	
	public void createLedger( Rec ptrec ){
		showLedger( ptrec );
	}
	
	public void showLedger( Rec rpRec ){
		
		//TODO -- need to really handle rpRec instead of ptRec
		
			
			Tab	tab;				// tab
			Tabpanel tabpanel;		// tabpanel

			
			// Does user have permission?
			if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW)){
				SystemHelpers.msgAccessDenied();
				return;
			}


			
			// If no particular patient specified, search for a patient
			if ( ! Rec.isValid( rpRec )){
				rpRec = new Rec( PtSearch.show());
				if ( ! Rec.isValid( rpRec )){
					// No patient found
					return;
				}			
			}
			
			// Make tab_panel name, see if it exists
			//   -- if it exists, select it quietly and return			
			String tabname = "rpledger_" + rpRec;			
			if (( tab = tabExists( tabname )) != null ){
				tab.setSelected(true);
				return;
			}
			
			// Create new tab and tabpanel
			tab = createTab( tabname, "RpLedger" );
			tabpanel = createTabpanel();
			
			// Create RpLedger
			RpLedger.show( rpRec, tabpanel );
			
			// Select this tabpanel
			tab.setSelected(true);
			
	}

	
	
	
	
	/**
	 * Create Browser Window
	 */

	public void createAboutWin(){
		showAboutWin();
	}
	
	public void showAboutWin(){
		
			Window win = (Window) Executions.createComponents( "about.zul", null, null );
			try {
				win.doModal();
			} catch (Exception e) {
				// ignore
			}
			return;
	}

	
	
	
	/**
	 * Create Browser Window
	 */

	public void createBrowser(){
		showBrowser( null );
	}
	
	public void createBrowser( String weburl ){
		showBrowser( weburl );
	}
	
	public void showBrowser( String weburl ){
			
			Tab	tab;				// tab
			Tabpanel tabpanel;		// tabpanel
			
			// If no particular weburl specified, ask user for one
			if (( weburl == null ) || ( weburl.trim().length() < 1 )){
				if (( weburl = DialogHelpers.Textbox( "Browser", "Enter the URL to open." )).length() < 1 ){
					// No website entered
					return;
				}			
			}
			//System.out.println( "showBrowser() weburl=" + weburl );
			
			// Make tab_panel name, see if it exists
			//   -- if it exists, select it quietly and return			
			String tabname = "browser_" + weburl;			
			if (( tab = tabExists( tabname )) != null ){
				tab.setSelected(true);
				return;
			}
			
			// Create new tab and tabpanel
			tab = createTab( tabname, "Web" );
			tabpanel = createTabpanel();
			
			// Create RpLedger
			Map<String, String> myMap = new HashMap();
			myMap.put("webUrl", weburl);
			
			Executions.createComponents( "browser.zul", tabpanel, myMap );
			
			// Select this tabpanel
			tab.setSelected(true);
	}

	
	
	
	
	

	
	
	public void createRxStatus(){ showRxStatus(); }
	
	public void showRxStatus(){
		
			Tab	tab;				// tab
			Tabpanel tabpanel;		// tabpanel
			
			// Does user have permission?
			if ( ! Perms.isRequestPermitted( Perms.Medical.PRESCRIPTIONS )){
				SystemHelpers.msgAccessDenied();
				return;
			}

			// Make tab_panel name, see if it exists
			//   -- if it exists, select it quietly and return
			String tabname = "rxstatus";			
			if (( tab = tabExists( tabname )) != null ){
				tab.setSelected(true);
				return;
			}
			
			// Create new tab and tabpanel
			tab = createTab( tabname, "RxStatus" );
			tabpanel = createTabpanel();
			tabpanel.setWidth( "100%" );
			tabpanel.setHeight( "100%" );
			
			ERxRefills.show( tabpanel );
			
			// Select this tabpanel
			tab.setSelected(true);
	}
	
	
	
	
	
	
	/**
	 * Edit Patient
	 */

	public void createNewPt(){
		showEditPt( EditPt.Operation.NEWPT, 0 );
	}

	public void createEditPt(){
		showEditPt( EditPt.Operation.EDITPT, 0 );
	}
	
	public void createEditPt( int ptrec ){
		showEditPt( EditPt.Operation.EDITPT, ptrec );
	}
	
	public void showEditPt( EditPt.Operation Operation, int ptRec ){
		
			Tab	tab;				// tab
			Tabpanel tabpanel;		// tabpanel
			String tabname;			// tab name
			String title;			// tab title

			

			System.out.println( "showEditPt() Operation=" + Operation.name() + "  ptRec=" + ptRec );
			
			if ( Operation == EditPt.Operation.NEWPT ){
				
				// Create a new patient
				
				tabname = "newpt";
				title = "New Patient";
				//TODO - make tab name unique
				
				
			} else {	// Operation == EditPt.Operation.EDITPT
			
				// If no particular patient specified, search for a patient
				if (  ptRec == 0 ){
					if (( ptRec = PtSearch.show()) == 0 ){
						// No patient found
						return;
					}			
				}
				
				// Make tab_panel name, see if it exists
				//   -- if it exists, select it quietly and return
				
				tabname = "editpt_" + ptRec;
				
				if (( tab = tabExists( tabname )) != null ){
					tab.setSelected(true);
					return;
				}
				
				title = "Edit Pt";
			}
			
			// Create new tab and tabpanel
			tab = createTab( tabname, title );
			tabpanel = createTabpanel();
			
			// Create EditPt window
			EditPt.show( Operation, new Rec( ptRec ), tabpanel );
			
			// Select this tabpanel
			tab.setSelected(true);
			return;
	}


	
	

	
	/**
	 * Edit Provider
	 */

	public void createNewProv(){
		showEditProv( EditPt.Operation.NEWPT, new Rec( 0 ));
	}

	public void createEditProv(){
		showEditProv( EditPt.Operation.EDITPT, new Rec( 0 ));
	}
	
	public void createEditProv( Rec provRec ){
		showEditProv( EditPt.Operation.EDITPT, provRec );
	}
	
	public void showEditProv( EditPt.Operation Operation, Rec provRec ){
		
			Tab	tab;				// tab
			Tabpanel tabpanel;		// tabpanel
			String tabname;			// tab name
			String title;			// tab title
			

			

			System.out.println( "showEditProv() Operation=" + Operation.name() + "  provRec=" + provRec );
			
			if ( Operation == EditPt.Operation.NEWPT ){
				
				// Create a new provider				
				tabname = "newprov";
				title = "New Provider";
				//TODO - make tab name unique
				
				
			} else {	// Operation == EditPt.Operation.EDITPT
			
				// If no particular patient specified, search for a patient
				if (( provRec == null ) || ( provRec.getRec() == 0 )){
					if (( provRec = ProvSearch.show()).getRec() == 0 ){
						// No provider selected
						return;
					}			
				}
				
				// Make tab_panel name, see if it exists
				//   -- if it exists, select it quietly and return
				
				tabname = "editprov_" + provRec.getRec();				
				if (( tab = tabExists( tabname )) != null ){
					tab.setSelected(true);
					return;
				}
				
				title = "Edit Provider";
			}
			
			// Create new tab and tabpanel
			System.out.println( "showEditProv() creating new tab provRec=" + provRec.getRec() );
			tab = createTab( tabname, title );
			tabpanel = createTabpanel();
			
			// Create EditPt window
			ProvEdit.show( Operation, provRec, tabpanel );
			
			// Select this tabpanel
			tab.setSelected(true);
			return;
	}

	
	
	
	
	
	/**
	 * ERx Config
	 */
	public void createERxConfig(){ showERxConfig(); }
	
	public void showERxConfig( ){
		
			Tab	tab;				// tab
			Tabpanel tabpanel;		// tabpanel
			String tabname;			// tab name
			String title;			// tab title
			

				
			// Make tab_panel name, see if it exists
			//   -- if it exists, select it quietly and return
			
			tabname = "erxconfig";			
			if (( tab = tabExists( tabname )) != null ){
				tab.setSelected(true);
				return;
			}
			
			title = "eRx Config";
			
			// Create new tab and tabpanel
			tab = createTab( tabname, title );
			tabpanel = createTabpanel();
			
			// Create EditPt window
			ERxConfigEdit.show( tabpanel );
			
			// Select this tabpanel
			tab.setSelected(true);
			return;
	}

	
	
	
	/**
	 * ERx Config
	 */
	public void createERxProvWin(){ showERxProvWin(); }
	
	public void showERxProvWin( ){
		
			Tab	tab;				// tab
			Tabpanel tabpanel;		// tabpanel
			String tabname;			// tab name
			String title;			// tab title
			

				
			// Make tab_panel name, see if it exists
			//   -- if it exists, select it quietly and return
			
			tabname = "erxprov";			
			if (( tab = tabExists( tabname )) != null ){
				tab.setSelected(true);
				return;
			}
			
			title = "eRx Providers";
			
			// Create new tab and tabpanel
			tab = createTab( tabname, title );
			tabpanel = createTabpanel();
			
			// Create EditPt window
			ERxProvWin.show( tabpanel );
			
			// Select this tabpanel
			tab.setSelected(true);
			return;
	}

	
	
	
	
	
	
	
	
	
	
	/**
	 * Create ProbTblWin
	 * 
	 * Create window to manage the Problem List Master Table
	 * 
	 */
	public void createProbTblWin(){ showProbTblWin(); }
	
	public void showProbTblWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return
		
		String tabname = "probTblWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "ProbTbl" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		ProbTblWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	
	
	/**
	 * Create LabObsTblWin
	 * 
	 * Create window to manage the Lab Observation Master Table
	 * 
	 */
	public void createLabObsTblWin(){ showLabObsTblWin(); }
	
	public void showLabObsTblWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return
		
		String tabname = "labObsTblWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		System.out.println( "showLabObsTblWin() creating new tab" );
		tab = createTab( tabname, "LabObsTbl" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		LabObsTblWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	
	
	/**
	 * Create LabBatWin
	 * 
	 * Create window to manage the Lab Batch Table
	 * 
	 */
	public void createLabBatWin(){ showLabBatWin(); }
	
	public void showLabBatWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return
		
		String tabname = "labBatWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		System.out.println( "showLabBatWin() creating new tab" );
		tab = createTab( tabname, "LabBat" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		LabBatWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	
	
	/**
	 * Create LabFacilityWin
	 * 
	 * Create window to manage the Lab Facility Table
	 * 
	 */
	public void createLabFacilityWin(){ showLabFacilityWin(); }
	
	public void showLabFacilityWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "labFacilityWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		System.out.println( "showLabFacilityWin() creating new tab" );
		tab = createTab( tabname, "LabFacility" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		LabFacilityWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	
	/**
	 * Create LabImport
	 * 
	 * Create window to manage the Lab Import
	 * 
	 */
	public void createLabImport(){ showLabImportWin(); }
	
	public void showLabImportWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "labImportWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "LabImport" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		LabImport.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	/**
	 * Create CDSRulesWin
	 * 
	 * Create window to manage the CDS Rules Table
	 * 
	 */
	public void createCDSRulesWin(){ showCDSRulesWin(); }
	
	public void showCDSRulesWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "cdsRulesWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "CDSRules" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		CDSRulesWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	

	
	/**
	 * Create Reminders
	 * 
	 * Create window to manage the Reminders
	 * 
	 */
	public void createRemindersWin(){ showRemindersWin(); }
	
	public void showRemindersWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "remindersWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "Reminders" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		RemindersWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	

	
	
	/**
	 * Create Pt Lists
	 * 
	 * Create window to manage the Pt Lists
	 * 
	 */
	public void createPtListWin(){ showPtListWin(); }
	
	public void showPtListWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "ptlistWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "PtList" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		PtListWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	

	
	
	/**
	 * Create CQM
	 * 
	 * Create window to manage the Clinical Quality Measures
	 * 
	 */
	public void createCQMWin(){ showCQMWin(); }
	
	public void showCQMWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return	
		String tabname = "cqmWin";	
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "CQM" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		CQMWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	

	
	
	/**
	 * Create AMC
	 * 
	 * Create window to manage the Automated Measures Calculations
	 * 
	 */
	public void createAMCWin(){ showAMCWin(); }
	
	public void showAMCWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel


		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "amcWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "Measures" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		AMCWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	

	
	
	
	
	/**
	 * Create UserEditWin
	 * 
	 * Create window to manage the current user's info
	 * 
	 */
	public void createUserEditWin(){ showUserEditWin(); }
	
	public void showUserEditWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

/*
		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return
		
		String tabname = "probTblWin";
		
		if (( tab = tabExists( tabname )) != null ){
			System.out.println( tabname + " exists");
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		System.out.println( "showProbTblWin() creating new tab" );
		tab = createTab( tabname, "ProbTbl" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
*/		
		// Get user record number from session attribute
		Rec userRec = (Rec) SystemHelpers.getSessionAttribute( "userrec" );
		// make sure record number is valid
		if ( ! Rec.isValid( userRec )){ SystemHelpers.seriousError( "showUserEditWin() bad userRec" ); return; }
		// Create UserEdit window
		UserEdit.edit( userRec, false, null );
		
		// Select this tabpanel
		//tab.setSelected(true);	
	}
	
	/**
	 * Create UserWin
	 * 
	 * Create window to manage the User
	 * 
	 */
	public void createUserWin(){ showUserWin(); }
	
	public void showUserWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
		if ( ! Perms.isRequestPermitted( Perms.Sys.USER_MANAGEMENT )){
			SystemHelpers.msgAccessDenied();
			return;
		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "userWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "Users" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create PtChart
		UserWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	/**
	 * Create AuditWin
	 * 
	 * Create window to view the Audit Log
	 * 
	 */
	public void createAuditWin(){ showAuditWin(); }
	
	public void showAuditWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
		if ( ! Perms.isRequestPermitted( Perms.Sys.USER_MANAGEMENT )){
			SystemHelpers.msgAccessDenied();
			return;
		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "auditWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "Audit Log" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create new Window
		AuditWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	/**
	 * Create SchWin
	 * 
	 * Create appointment scheduler window
	 * 
	 */
	public void createSchWin(){ showSchWin(); }
	
	public void showSchWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW ) && ! Perms.isRequestPermitted( Perms.Medical.VIEW )){
			SystemHelpers.msgAccessDenied();
			return;
		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "schWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "Scheduler" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create new Window
		SchWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	/**
	 * Create EcsWin
	 * 
	 * Create window to manage Electronic Claims
	 * 
	 */
	public void createEcsWin(){ showEcsWin(); }
	
	public void showEcsWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW )){
			SystemHelpers.msgAccessDenied();
			return;
		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "ecsWin";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "ECS" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create window
		EcsWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	
	/**
	 * Create PmImportWin
	 * 
	 * Create window to Import Documents
	 * 
	 */
	public void createPmImportWin(){ showPmImportWin(); }
	
	public void showPmImportWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
//		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW )){
//			SystemHelpers.msgAccessDenied();
//			return;
//		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "pmimport";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "PmImport" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create window
		PmImportWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	
	
	
	

	/**
	 * Create VaccineCVXWin
	 * 
	 * Create window to View/Edit Vaccine CVX Records
	 * 
	 */
	public void createVaccineCVXWin(){ showVaccineCVXWin(); }
	
	public void showVaccineCVXWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
//		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW )){
//			SystemHelpers.msgAccessDenied();
//			return;
//		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "vaccvx";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "Vaccine CVX" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create window
		VaccineCVXWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	

	
	/**
	 * Create VaccineMVXWin
	 * 
	 * Create window to View/Edit Vaccine MVX Records
	 * 
	 */
	public void createVaccineMVXWin(){ showVaccineMVXWin(); }
	
	public void showVaccineMVXWin(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
//		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW )){
//			SystemHelpers.msgAccessDenied();
//			return;
//		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "vacmvx";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "Vaccine MVX" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		// Create window
		VaccineMVXWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}
	


	
	/**
	 * Create CdmDashboard Win
	 * 
	 * Create window to View CDM Dashboard
	 * 
	 */
	public void createCdmDashboard(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
//		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW )){
//			SystemHelpers.msgAccessDenied();
//			return;
//		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "cdmDashboard";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "CDM Dashboard" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		
		
		// Create window
		CdmWin.show( tabpanel );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}

	

	/**
	 * Create XfrVitals Win
	 * 
	 * Create window to View/Edit Vaccine MVX Records
	 * 
	 */
	public void createXfrVitals(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
//		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW )){
//			SystemHelpers.msgAccessDenied();
//			return;
//		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "xfrVitals";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "XFR Vitals" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		String start = DialogHelpers.Textbox("Transfer PARs", "Enter a starting date.");
		if (( start == null ) || ( start.length() < 1 )) start = "1-1-1982";
		Date dateStart = new Date( start );
		
		String end = DialogHelpers.Textbox("Transfer PARs", "Enter an end date.");
		if (( end == null ) || ( end.length() < 1 )) end = Date.today().getPrintable();
		Date dateEnd = new Date( end );
		
		DialogHelpers.Messagebox( "Start.  Transferring from " + dateStart.getPrintable() + " to " + dateEnd.getPrintable() +"." );
		
		// Create window
		TransferVitals.transfer( dateStart, dateEnd );
		
		DialogHelpers.Messagebox( "Done" );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}

	
	/**
	 * Create XfrPARs Win
	 * 
	 * Create window to View/Edit Vaccine MVX Records
	 * 
	 */
	public void createXfrPARs(){
		
		Tab	tab;				// tab
		Tabpanel tabpanel;		// tabpanel

		// Does user have permission?
//		if ( ! Perms.isRequestPermitted( Perms.Financial.VIEW )){
//			SystemHelpers.msgAccessDenied();
//			return;
//		}

		// Make tab_panel name, see if it exists
		//   -- if it exists, select it quietly and return		
		String tabname = "xfrPARs";		
		if (( tab = tabExists( tabname )) != null ){
			tab.setSelected(true);
			return;
		}
		
		// Create new tab and tabpanel
		tab = createTab( tabname, "XFR PARs" );
		tabpanel = createTabpanel();
		tabpanel.setWidth( "100%" );
		tabpanel.setHeight( "100%" );
		
		String start = DialogHelpers.Textbox("Transfer PARs", "Enter a starting date.");
		if (( start == null ) || ( start.length() < 1 )) start = "1-1-1982";
		
		String end = DialogHelpers.Textbox("Transfer PARs", "Enter an end date.");
		if (( end == null ) || ( end.length() < 1 )) end = Date.today().getPrintable();
		
		DialogHelpers.Messagebox( "Start" );
		
		
		
		// Create window
		TransferPars.transfer( new Date( start ), new Date( end ));
		
		DialogHelpers.Messagebox( "Done" );
		
		// Select this tabpanel
		tab.setSelected(true);	
	}

	
}

/**/
